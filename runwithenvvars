#!/bin/bash
  
export OMPI_COMM_WORLD_RANK=${PMIX_RANK}
export OMPI_COMM_WORLD_SIZE=${SLURM_NTASKS}
export OMPI_COMM_WORLD_LOCAL_SIZE=$((SLURM_NTASKS / SLURM_NNODES))
export OMPI_COMM_WORLD_LOCAL_RANK=$((PMIX_RANK % OMPI_COMM_WORLD_LOCAL_SIZE))
export OMPI_COMM_WORLD_NODE_RANK=$((PMIX_RANK / $OMPI_COMM_WORLD_LOCAL_SIZE))

export SAGEMAKER_INSTANCE_TYPE="ml.p4d.24xlarge"
export NCCL_SOCKET_IFNAME="^lo,docker"

$@

